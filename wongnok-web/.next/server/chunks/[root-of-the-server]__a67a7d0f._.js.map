{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 6, "column": 0}, "map": {"version":3,"sources":[],"names":[],"mappings":"","debugId":null}},
    {"offset": {"line": 162, "column": 0}, "map": {"version":3,"sources":["file:///E:/DevPoolLearning/Devpool-project_fortest/Devpool-Project1/wongnok-web/src/lib/axios.ts"],"sourcesContent":["import axios from 'axios'\r\nimport { getSession ,signIn } from 'next-auth/react'\r\n\r\n\r\nexport const api = axios.create({\r\n  baseURL: process.env.NEXT_PUBLIC_BASE_PATH,\r\n})\r\n\r\napi.interceptors.request.use(async (config) => {\r\n  const session = await getSession()\r\n  config.headers.Authorization = `Bearer ${session?.accessToken || ''}`\r\n  return config\r\n})\r\n\r\napi.interceptors.response.use(\r\n  response => response,\r\n  async error => {\r\n    // ถ้า token หมดอายุ\r\n    if (error.response?.status === 401) {\r\n      const session = await getSession()\r\n      // ถ้ามี refreshToken ให้เรียก endpoint refresh\r\n      if (session?.refreshToken) {\r\n        try {\r\n          const res = await axios.post(\r\n            `${process.env.NEXT_PUBLIC_BASE_PATH}/auth/refresh`,\r\n            { refresh_token: session.refreshToken }\r\n          )\r\n          // สมมติว่า response มี accessToken ใหม่\r\n          session.accessToken = res.data.accessToken\r\n          // retry request เดิม\r\n          error.config.headers.Authorization = `Bearer ${session.accessToken}`\r\n          return api.request(error.config)\r\n        } catch (refreshError) {\r\n          // refresh ไม่สำเร็จ ให้ redirect ไป login\r\n          signIn()\r\n        }\r\n      } else {\r\n        // ไม่มี refreshToken ให้ login ใหม่\r\n        signIn()\r\n      }\r\n    }\r\n    return Promise.reject(error)\r\n  }\r\n)\r\n"],"names":[],"mappings":";;;AAAA;AACA;;;AAGO,MAAM,MAAM,uIAAA,CAAA,UAAK,CAAC,MAAM,CAAC;IAC9B,OAAO;AACT;AAEA,IAAI,YAAY,CAAC,OAAO,CAAC,GAAG,CAAC,OAAO;IAClC,MAAM,UAAU,MAAM,CAAA,GAAA,gJAAA,CAAA,aAAU,AAAD;IAC/B,OAAO,OAAO,CAAC,aAAa,GAAG,CAAC,OAAO,EAAE,SAAS,eAAe,IAAI;IACrE,OAAO;AACT;AAEA,IAAI,YAAY,CAAC,QAAQ,CAAC,GAAG,CAC3B,CAAA,WAAY,UACZ,OAAM;IACJ,oBAAoB;IACpB,IAAI,MAAM,QAAQ,EAAE,WAAW,KAAK;QAClC,MAAM,UAAU,MAAM,CAAA,GAAA,gJAAA,CAAA,aAAU,AAAD;QAC/B,+CAA+C;QAC/C,IAAI,SAAS,cAAc;YACzB,IAAI;gBACF,MAAM,MAAM,MAAM,uIAAA,CAAA,UAAK,CAAC,IAAI,CAC1B,6DAAqC,aAAa,CAAC,EACnD;oBAAE,eAAe,QAAQ,YAAY;gBAAC;gBAExC,wCAAwC;gBACxC,QAAQ,WAAW,GAAG,IAAI,IAAI,CAAC,WAAW;gBAC1C,qBAAqB;gBACrB,MAAM,MAAM,CAAC,OAAO,CAAC,aAAa,GAAG,CAAC,OAAO,EAAE,QAAQ,WAAW,EAAE;gBACpE,OAAO,IAAI,OAAO,CAAC,MAAM,MAAM;YACjC,EAAE,OAAO,cAAc;gBACrB,0CAA0C;gBAC1C,CAAA,GAAA,gJAAA,CAAA,SAAM,AAAD;YACP;QACF,OAAO;YACL,oCAAoC;YACpC,CAAA,GAAA,gJAAA,CAAA,SAAM,AAAD;QACP;IACF;IACA,OAAO,QAAQ,MAAM,CAAC;AACxB","debugId":null}},
    {"offset": {"line": 231, "column": 0}, "map": {"version":3,"sources":["file:///E:/DevPoolLearning/Devpool-project_fortest/Devpool-Project1/wongnok-web/src/app/api/auth/%5B...nextauth%5D/route.ts"],"sourcesContent":["import { api } from '@/lib/axios'\r\nimport { User } from '@/services/recipe.service'\r\nimport NextAuth from 'next-auth'\r\nimport KeycloakProvider from 'next-auth/providers/keycloak'\r\n\r\nconst handler = NextAuth({\r\n  providers: [\r\n    KeycloakProvider({\r\n      clientId: process.env.KEYCLOAK_CLIENT_ID ?? '',\r\n      clientSecret: process.env.KEYCLOAK_CLIENT_SECRET ?? '',\r\n      issuer: process.env.KEYCLOAK_ISSUER,\r\n      authorization: { params: { prompt: 'login' } },\r\n    }),\r\n  ],\r\n\r\n  callbacks: {\r\n    // for keep jwt token\r\n    async jwt({ token, account }) {\r\n      if (account) {\r\n        console.log('account : ', account)\r\n        token.accessToken = account.access_token\r\n        token.userId = account.providerAccountId\r\n      }\r\n      return token\r\n    },\r\n\r\n    // get session data from jwt token\r\n    async session({ session, token }) {\r\n      // console.log('token -------->',token)\r\n      session.accessToken = token.accessToken\r\n      session.userId = token.userId\r\n      try {\r\n        await api.post<{ results: User[] }>(`/api/v1/users/`)\r\n      } catch (err) {\r\n        console.error('Create user error:', err)\r\n      }\r\n      return session\r\n    },\r\n  },\r\n  secret: process.env.NEXTAUTH_SECRET,\r\n})\r\n\r\nexport { handler as GET, handler as POST }\r\n"],"names":[],"mappings":";;;;AAAA;AAEA;AACA;;;;AAEA,MAAM,UAAU,CAAA,GAAA,uIAAA,CAAA,UAAQ,AAAD,EAAE;IACvB,WAAW;QACT,CAAA,GAAA,uJAAA,CAAA,UAAgB,AAAD,EAAE;YACf,UAAU,QAAQ,GAAG,CAAC,kBAAkB,IAAI;YAC5C,cAAc,QAAQ,GAAG,CAAC,sBAAsB,IAAI;YACpD,QAAQ,QAAQ,GAAG,CAAC,eAAe;YACnC,eAAe;gBAAE,QAAQ;oBAAE,QAAQ;gBAAQ;YAAE;QAC/C;KACD;IAED,WAAW;QACT,qBAAqB;QACrB,MAAM,KAAI,EAAE,KAAK,EAAE,OAAO,EAAE;YAC1B,IAAI,SAAS;gBACX,QAAQ,GAAG,CAAC,cAAc;gBAC1B,MAAM,WAAW,GAAG,QAAQ,YAAY;gBACxC,MAAM,MAAM,GAAG,QAAQ,iBAAiB;YAC1C;YACA,OAAO;QACT;QAEA,kCAAkC;QAClC,MAAM,SAAQ,EAAE,OAAO,EAAE,KAAK,EAAE;YAC9B,uCAAuC;YACvC,QAAQ,WAAW,GAAG,MAAM,WAAW;YACvC,QAAQ,MAAM,GAAG,MAAM,MAAM;YAC7B,IAAI;gBACF,MAAM,qHAAA,CAAA,MAAG,CAAC,IAAI,CAAsB,CAAC,cAAc,CAAC;YACtD,EAAE,OAAO,KAAK;gBACZ,QAAQ,KAAK,CAAC,sBAAsB;YACtC;YACA,OAAO;QACT;IACF;IACA,QAAQ,QAAQ,GAAG,CAAC,eAAe;AACrC","debugId":null}}]
}